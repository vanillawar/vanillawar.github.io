<!-- {"title": "Honor Pool Estimation", "rel": "../../", "header": false} -->
<script>
// LIB
function get(id) {
  return document.getElementById(id)
}
function setText(id, text) {
  get(id).textContent = text
}
// END LIB
</script>

<noscript><div class="card error fluid">Please activate Javascript to use this site!</div></noscript>

<h1><a href="https://www.vanillawar.com">&lt;</a> WoW Classic Honor Pool Estimation</h1>

<form id="input" action="https://vanillawar-honor-pool.herokuapp.com/data" method="post">
    <label for="before" style="vertical-align: top;">HonorSpy<br><small>(before update)</small></label>
    <textarea id="before" name="before" style="font-family:monospace;width:100%;"></textarea><br>
    <label for="after" style="vertical-align: top;">HonorSpy<br><small>(after update)</small></label>
    <textarea id="after" name="after" style="font-family:monospace;width:100%;"></textarea><br>
    <input type="submit" value="Calculate (takes some time, be patient!)">
    <!--
      <input type="button" value="Clear" onclick="location.href='https://www.vanillawar.com/tools/honor-pool/'">
      <input type="button" value="Example" onclick="location.href='https://www.vanillawar.com/tools/honor-pool/'">
    -->
</form>

<h2>Results</h2>

<img src="" id="img_st2rp" alt="Standing to RP" style="display:none;">
<img src="" id="img_st2honor" alt="Honor per standing" style="display:none;">

<textarea id="results" style="width:100%;font-family:monospace;" readonly>
</textarea>

<script>
</script>

<h3>Instructions</h3>

<ol>
  <li>Install the <a href="https://www.curseforge.com/wow/addons/honorspy" target="_blank">HonorSpy</a> addon, play and let it record data</li>
  <li>Before the PvP ends (e.g. Tuesday evening for EU servers), go to "Interface Options" > "AddOns" > select "HonorSpy" and "Export to CSV". Press the button, your client will hang a bit and a popup with data will be shown.
    Copy&amp;paste this to a <code>.txt</code> file.
    <img src="hs_export.png" alt="HonorSpy export menu">
  </li>
  <li>Do the same after reset, when HonorSpy has been filled with 400, 500 or more entries (if reset is on Wednesday, HonorSpy won't fill before Thursday).
    Again, save the data in a separate <code>.txt</code> file.</li>
  <li>Copy&amp;paste the data from the "before update" textfile in the upper box, the data from the "after update" textfile in the lower box. Press "Calculate".</li>
  <li>(Optional: you may sanitize the data beforehand, since sometimes players sync bogus data in HonorSpy. This will increase accuracy of this tool.)</li>
</ol>

<p>
  How to read the graphs:
</p>

<ul>
  <li>TODO</li>
</ul>

<script src="https://vanillawar-honor-pool.herokuapp.com/warmup.js"></script>
<iframe id="data_loader" src="" style="display:none;"></iframe>

<script type="text/javascript">
function getParameters() {
    const url = new URL(window.location.href)
    let parameters = {
        'data': String(url.searchParams.get('data') || '')
    }
    return parameters
}
var PARAMS = getParameters()
if (PARAMS['data'] !== '') {
  var id = PARAMS['data']
  //setText('results', PARAMS['data'])
  fetch(`https://vanillawar-honor-pool.herokuapp.com/data/${id}.txt`)
  .then(
    function(response) {
      if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
          response.status);
        return;
      }
      response.text().then(function(data) {
        setText('results', data)
        get('results').style.height = get('results').scrollHeight + 5 + "px"
        get('img_st2rp').src = `https://vanillawar-honor-pool.herokuapp.com/data/${id}_st2rp.png`
        get('img_st2rp').style.display = 'inherit'
        get('img_st2honor').src = `https://vanillawar-honor-pool.herokuapp.com/data/${id}_st2honor.png`
        get('img_st2honor').style.display = 'inherit'
      });
    }
  )
  .catch(function(err) {
    console.log('fetch error: ', err);
  });
}
</script>
