<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' *;">
    <link rel="stylesheet" href="https://cdn.rawgit.com/Chalarangelo/mini.css/v3.0.1/dist/mini-default.min.css" />
    <link rel="stylesheet" href="../../static/vanillawar.css" />
    <link rel="shortcut icon" type="image/png" href="../../static/logo.png" />
    <title>Taunt Generator | Vanilla Warrior</title>
    <meta name="description" content="World of Warcraft: Classic (Vanilla) Warrior guides and resources!" />
    <meta name="robots" content="index, follow" />

    <meta property="og:type" content="article" />
    <meta property="og:title" content="Taunt Generator | Vanilla Warrior" />
    <meta property="og:description" content="World of Warcraft: Classic (Vanilla) Warrior guides and resources!" />
    <meta property="og:image" content="https://www.vanillawar.com/static/logo.png" />
    <meta property="twitter:title" content="Taunt Generator | Vanilla Warrior" />
    <meta property="twitter:description" content="World of Warcraft: Classic (Vanilla) Warrior guides and resources!" />
    <meta property="twitter:creator" content="@WarlordDrak" />
    <meta property="twitter:site" content="@WarlordDrak" />
    <meta property="twitter:image" content="https://www.vanillawar.com/static/logo.png" />

    <script>
// LIB
function get(id) {
  return document.getElementById(id)
}
function setText(id, text) {
  get(id).textContent = text
}
function round2dec(num) {
  return num.toFixed(2)
}
// END LIB

// HONOR LIB
const BREAK_PTS = [0.002 // r14
, 0.007
, 0.017
, 0.037
, 0.077 // r10
, 0.137
, 0.207
, 0.287 // r7
]
const REF_WEEK = [ 13000.0 // top CP score gets top RP score
, 12000.0  // breakpoint 14
, 11000.0
, 10000.0
,  9000.0
,  8000.0
,  7000.0  // breakpoint 9
,  6000.0
,  5000.0
,  4000.0
,  3000.0
,  2000.0  // breakpoint 4
,  1000.0
,   400.0
,     0.0 // bottom end point
]
function rank2rp(rank) {
    var _rank   = Math.floor(rank)
    var percent = rank - _rank
    if (rank >= 3.0) {
        return (rank - 2.0) * 5000.0
    } else if (rank >= 2.0) {
        return 2000 + (rank - 2.0) * 3000
    }
    return 0.0
}
function rp2rank(rp) {
    if (rp >= 5000.0) {
        return rp / (5000.0) + 2.0
    } else if (rp >= (2000.0)) {
        return 2.0
    }
    return 0.0
}
function groups(players) {
    return BREAK_PTS.map(break_pt => Math.floor(Math.round(break_pt * players)))
}
function render_groups(groups) {
    rank = 14
    return groups.map((group, idx) =>
    `Top ${group} standing is bracket ${idx + 1}, gaining ${REF_WEEK[idx+1]} - ${REF_WEEK[idx]} RP (r${rank - idx} cutoff)`)
}
// END HONOR LIB
    </script>
</head>

<body>
    <div class="container">
        <noscript><div class="card error fluid">Please activate Javascript to use this site!</div></noscript>

        <h1>WoW Classic Honor Calculator</h1>

        <p>
        Estimates based on your current <code>rank</code> (default <code>7.0</code>), your estimated <code>standing</code> (default <code>100</code>) and an estimate for the total number of <code>players</code> (default <code>2000</code>).
        All parameters are passed as URL parameters, like this:
        </p>

        <pre>?rank=9.40&amp;standing=50&amp;players=1500</pre>

        <p>
        A <code>rank</code> of <code>9.4</code> means that you are rank 9 and 40% progressed towards rank 10.
        </p>

        <p>
        The RP/rank gain estimation is more accurate the closer you are to the center of your bracket.
        The closer you are to the top of the bracket, the higher the estimation could be (meaning you will probably gain less).
        The closer you are to the bottom of the bracket, the lower the estimation could be (meaning you will probably gain more).
        It also depends on how close or far the players at the bracket borders are CP-wise:
        The greater the gap, the more gain for the bottom player(s) in the higher bracket and the less gain for the top player(s) in the lower bracket.
        The smaller the gap, the more less for the bottom player(s) in the higher bracket and the more gain for the top player(s) in the lower bracket.
        </p>

            <h3>Results</h3>

            <textarea id="brackets_list" style="width:100%;height:23em;font-family:monospace;">
            </textarea>

            <script type="text/javascript">
        function getParameters() {
          const url = new URL(window.location.href)
          return {
            'rank' : Number(url.searchParams.get('rank') || 7.0),
            'standing' : Number(url.searchParams.get('standing') || 100.0),
            'players' : Number(url.searchParams.get('players') || 2000.0),
          }
        }
        const PARAMETERS = getParameters()
        const STANDING = PARAMETERS.standing
        const CALC_RP = rank2rp(PARAMETERS.rank)
        const DECAY = CALC_RP * 0.2
        const RP_AFTER_DECAY = CALC_RP - DECAY
        function bracket(standing, groups) {
          var brkt = 1.0
          var upperBound = 1.0
          var lowerBound = 1.0
          for (i = 0; i < groups.length; ++i) {
            var grp = groups[i]
            if (standing <= grp) {
              lowerBound = grp
              break;
            }
            upperBound = Number(grp) + 1.0
            brkt += 1.0
          }
          return {
            'bracket': brkt,
            'upperSt': upperBound,
            'lowerSt': lowerBound,
            'bracket_players': lowerBound - upperBound + 1.0,
            'upperRp': REF_WEEK[brkt - 1],
            'lowerRp': REF_WEEK[brkt],
            'rpEstimate': 0.0
          }
        }
        const grps = groups(PARAMETERS.players)
        const brkt = bracket(PARAMETERS.standing, grps)
        const standingRelativeToBracket = (brkt.lowerSt - STANDING + 1.0) / brkt.bracket_players
        const RP_AFTER_MAX_GAIN = RP_AFTER_DECAY + brkt.upperRp
        const RP_AFTER_MIN_GAIN = RP_AFTER_DECAY + brkt.lowerRp
        const RP_GAIN_ESTIMATE = (brkt.upperRp - brkt.lowerRp) * standingRelativeToBracket + brkt.lowerRp
        const RP_AFTER_GAIN_ESTIMATE = RP_AFTER_DECAY + RP_GAIN_ESTIMATE
        const MAX_RANK_AFTER_UPDATE = round2dec(rp2rank(RP_AFTER_MAX_GAIN))
        const MIN_RANK_AFTER_UPDATE = round2dec(rp2rank(RP_AFTER_MIN_GAIN))
        const RANK_ESTIMATE = round2dec(rp2rank(RP_AFTER_GAIN_ESTIMATE))
        get('brackets_list').value = `Currently rank ${round2dec(PARAMETERS.rank)} (${round2dec(CALC_RP)} RP), decaying ${round2dec(DECAY)} RP\n`

        get('brackets_list').value += `With your estimated standing of ${STANDING}, you will be in bracket: ${brkt.bracket}\n`
        get('brackets_list').value += `Gaining between ${brkt.lowerRp} and ${brkt.upperRp}  RP, estimating RP gain of ${round2dec(RP_GAIN_ESTIMATE)}\n`
        get('brackets_list').value += `Reaching between r${MIN_RANK_AFTER_UPDATE} and r${MAX_RANK_AFTER_UPDATE}, estimating rank ${RANK_ESTIMATE}\n\n`
        get('brackets_list').value += `Brackets:\n`
        get('brackets_list').value += render_groups(grps).join('\n')
            </script>

        <div class="row" style="margin-top:2em; padding:0em; text-align:center;">
            <div class="col-sm">
                <a href="https://www.vanillawar.com"><img src="../../static/logo.png" alt="VanillaWar.com icon" /></a>
            </div>
        </div>
    </div>
</body>

</html>